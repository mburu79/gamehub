<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Love Notes - Synced</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;600;700&family=Poppins:wght@300;400;600&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; color: #fff; }
    .container { max-width: 700px; width: 100%; text-align: center; z-index: 10; }
    h1 { font-family: 'Dancing Script', cursive; font-size: 4em; margin-bottom: 20px; text-shadow: 3px 3px 6px rgba(0,0,0,0.3); }
    .note-card { background: rgba(255, 255, 255, 0.95); border-radius: 25px; padding: 50px 40px; box-shadow: 0 30px 80px rgba(0,0,0,0.3); color: #333; margin-bottom: 30px; min-height: 300px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .note-icon { font-size: 4em; margin-bottom: 20px; }
    .note-text { font-family: 'Dancing Script', cursive; font-size: 2em; line-height: 1.6; color: #f5576c; margin-bottom: 20px; max-width: 500px; font-weight: 600; }
    .note-from { font-size: 1.2em; color: #999; font-style: italic; margin-top: 20px; }
    .buttons { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
    button { padding: 15px 30px; font-family: 'Poppins', sans-serif; font-size: 1.1em; font-weight: 600; cursor: pointer; background: rgba(255, 255, 255, 0.3); color: white; border: 2px solid rgba(255, 255, 255, 0.5); border-radius: 25px; transition: all 0.3s; }
    .primary-btn { background: rgba(255, 255, 255, 0.95) !important; color: #f5576c !important; }
    .custom-note-area { display: none; margin-top: 20px; }
    .custom-note-area.active { display: block; }
    .custom-note-input { width: 100%; padding: 20px; font-family: 'Dancing Script', cursive; font-size: 1.5em; border: 2px solid #ddd; border-radius: 15px; resize: vertical; min-height: 120px; margin-bottom: 15px; }
    .saved-notes { margin-top: 30px; text-align: left; }
    .saved-note-item { background: #f5f5f5; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
    .saved-note-text { flex: 1; font-family: 'Dancing Script', cursive; font-size: 1.2em; color: #f5576c; }
    .delete-saved-note { cursor: pointer; color: #e74c3c; font-size: 1.2em; padding: 5px 10px; }
    .back-btn { display: inline-block; padding: 10px 20px; background: rgba(255,255,255,0.2); color: white; text-decoration: none; border-radius: 10px; margin-bottom: 20px; }
    .sync-badge { background: #2ecc71; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.7em; }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-btn">‚Üê Back to Hub</a>
    <h1>üíï Love Notes <span class="sync-badge">üîÑ Synced</span></h1>
    
    <div class="note-card">
      <div class="note-icon" id="note-icon">üíå</div>
      <div class="note-text" id="note-text">Click below to see a sweet message!</div>
      <div class="note-from" id="note-from"></div>
      
      <div class="custom-note-area" id="custom-note-area">
        <textarea class="custom-note-input" id="custom-note-input" placeholder="Write your own love note..."></textarea>
      </div>
      
      <div class="saved-notes" id="saved-notes-container" style="display: none;">
        <div style="font-size: 1.3em; margin-bottom: 15px; font-weight: 600;">Our Love Notes üíå</div>
        <div id="saved-notes-list"></div>
      </div>
    </div>
    
    <div class="buttons">
      <button class="primary-btn" onclick="getRandomNote()">‚ú® Random Note</button>
      <button onclick="toggleCustomNote()">‚úèÔ∏è Write One</button>
      <button onclick="toggleSavedNotes()">üìö View All</button>
    </div>
  </div>

  <script type="module">
    import { database } from './firebase-config.js';
    import { ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

    const currentUser = localStorage.getItem('currentUser') || 'Guest';
    const notesRef = ref(database, 'loveNotes');
    let savedNotes = [];
    let customNoteMode = false;
    let viewingAllNotes = false;

    const loveNotes = [
      { text: "Every moment with you is a treasure I'll keep forever", icon: "üíé" },
      { text: "You make my heart smile in ways I never knew possible", icon: "üòä" },
      { text: "Distance means nothing when someone means everything", icon: "üåç" },
      { text: "You're not just my love, you're my best friend", icon: "üë´" },
      { text: "I fall for you more and more every single day", icon: "üçÇ" },
      { text: "You're the reason I believe in magic", icon: "‚ú®" },
      { text: "My favorite place in the world is next to you", icon: "üè°" },
      { text: "You're my today and all of my tomorrows", icon: "üåÖ" },
      { text: "Together is my favorite place to be", icon: "üíë" },
      { text: "You make the ordinary feel extraordinary", icon: "üåü" },
      { text: "I love you more than yesterday, less than tomorrow", icon: "üìÜ" },
      { text: "You're the best thing that ever happened to me", icon: "üéÅ" }
    ];

    // Listen for saved notes
    onValue(notesRef, (snapshot) => {
      savedNotes = [];
      if (snapshot.exists()) {
        snapshot.forEach(child => {
          savedNotes.push({ id: child.key, ...child.val() });
        });
      }
      if (viewingAllNotes) loadSavedNotes();
    });

    window.getRandomNote = function() {
      const note = loveNotes[Math.floor(Math.random() * loveNotes.length)];
      document.getElementById('note-icon').textContent = note.icon;
      document.getElementById('note-text').textContent = note.text;
      document.getElementById('note-from').textContent = '- With Love';
      document.getElementById('custom-note-area').classList.remove('active');
      document.getElementById('saved-notes-container').style.display = 'none';
      customNoteMode = false;
      viewingAllNotes = false;
    };

    window.toggleCustomNote = function() {
      customNoteMode = !customNoteMode;
      const customArea = document.getElementById('custom-note-area');
      
      if (customNoteMode) {
        customArea.classList.add('active');
        document.getElementById('note-icon').textContent = '‚úèÔ∏è';
        document.getElementById('note-text').textContent = 'Write your own love note:';
        document.getElementById('note-from').textContent = '';
        document.getElementById('saved-notes-container').style.display = 'none';
        viewingAllNotes = false;
        
        if (!document.getElementById('save-note-btn')) {
          const saveBtn = document.createElement('button');
          saveBtn.id = 'save-note-btn';
          saveBtn.className = 'primary-btn';
          saveBtn.textContent = 'üíæ Save Note';
          saveBtn.style.marginTop = '15px';
          saveBtn.onclick = saveCustomNote;
          customArea.appendChild(saveBtn);
        }
      } else {
        customArea.classList.remove('active');
        getRandomNote();
      }
    };

    window.saveCustomNote = async function() {
      const text = document.getElementById('custom-note-input').value.trim();
      if (!text) return alert('Please write something first!');
      
      await push(notesRef, {
        text,
        author: currentUser,
        timestamp: new Date().toISOString()
      });
      
      document.getElementById('custom-note-input').value = '';
      document.getElementById('note-icon').textContent = 'üíå';
      document.getElementById('note-text').textContent = 'Your love note has been saved! üíï';
      document.getElementById('note-from').textContent = `- ${currentUser}`;
      setTimeout(() => toggleCustomNote(), 2000);
    };

    window.toggleSavedNotes = function() {
      viewingAllNotes = !viewingAllNotes;
      const container = document.getElementById('saved-notes-container');
      
      if (viewingAllNotes) {
        container.style.display = 'block';
        document.getElementById('custom-note-area').classList.remove('active');
        customNoteMode = false;
        document.getElementById('note-icon').textContent = 'üíå';
        document.getElementById('note-text').textContent = 'All our love notes:';
        document.getElementById('note-from').textContent = '';
        loadSavedNotes();
      } else {
        container.style.display = 'none';
        getRandomNote();
      }
    };

    function loadSavedNotes() {
      const list = document.getElementById('saved-notes-list');
      list.innerHTML = '';
      
      if (savedNotes.length === 0) {
        list.innerHTML = '<p style="text-align: center; color: #999;">No saved notes yet. Write one!</p>';
        return;
      }
      
      savedNotes.slice().reverse().forEach(note => {
        const div = document.createElement('div');
        div.className = 'saved-note-item';
        div.innerHTML = `
          <div class="saved-note-text">"${note.text}"</div>
          <div style="font-size: 0.9em; color: #999; margin-left: 10px;">- ${note.author}</div>
          <span class="delete-saved-note" onclick="deleteSavedNote('${note.id}')">üóëÔ∏è</span>
        `;
        list.appendChild(div);
      });
    }

    window.deleteSavedNote = async function(id) {
      if (confirm('Delete this love note?')) {
        await remove(ref(database, `loveNotes/${id}`));
      }
    };

    getRandomNote();
  </script>
</body>
</html>
